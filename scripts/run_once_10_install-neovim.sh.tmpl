#!/bin/bash
set -euxo pipefail

if command -v nvim >/dev/null 2>&1 && nvim --version | grep -q "v0.11"; then
  echo "✔️ Neovim v0.11+ already installed"
  exit 0
fi

echo "📦 Downloading latest Neovim AppImage..."
curl -LO https://github.com/neovim/neovim/releases/nightly/download/nvim.appimage
chmod u+x nvim.appimage

echo "📦 Extracting AppImage to ~/.local/nvim"
./nvim.appimage --appimage-extract
rm nvim.appimage

# Move to ~/.local
mkdir -p ~/.local
mv squashfs-root ~/.local/nvim

# Symlink nvim to ~/.local/bin
mkdir -p ~/.local/bin
ln -sf ~/.local/nvim/AppRun ~/.local/bin/nvim

# Add to PATH
if ! grep -q 'nvim/bin' ~/.profile; then
  echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.profile
fi

export PATH="$HOME/.local/bin:$PATH"
echo "✅ Installed: $(nvim --version | head -n 1)"

