# Load universal profile (for PATH etc.)
[ -f "$HOME/.profile" ] && source "$HOME/.profile"

# ---- XDG early (before anything uses them) ----
: ${XDG_CONFIG_HOME:="$HOME/.config"}
: ${XDG_DATA_HOME:="$HOME/.local/share"}

# ---- Oh My Zsh ----
# Path to your oh-my-zsh installation.
export ZSH="$XDG_DATA_HOME/oh-my-zsh"
ZSH_THEME="robbyrussell"
plugins=(git)
source $ZSH/oh-my-zsh.sh

# ---- Platform detection ----
is_macos() { [[ "$OSTYPE" == darwin* ]]; }
is_linux() { [[ "$OSTYPE" == linux* ]]; }


# ---- Aliases ----
alias ssha='eval "$(ssh-agent -s)" && ssh-add ~/.ssh/id_rsa'

alias gitl="git log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit"

# ---- fzf integration (portable, single source of truth) ----
if [[ $- == *i* ]]; then
  for dir in \
    /usr/share/doc/fzf/examples \
    ~/.fzf/shell \
    "$(is_macos && command -v brew >/dev/null && brew --prefix)/opt/fzf/shell"
  do
    [[ -r "$dir/completion.zsh" ]]   && source "$dir/completion.zsh"
    [[ -r "$dir/key-bindings.zsh" ]] && source "$dir/key-bindings.zsh"
  done
fi

# ---- Keybinding tweaks ----
# make zsh have vim keybindings
bindkey -v

# Alt-c becomes the cedilla with iTerm2
bindkey "รง" fzf-cd-widget

# The following lines have been added by Docker Desktop to enable Docker CLI completions.
fpath=($HOME/.docker/completions $fpath)
# End of Docker CLI completions


# make chezmoi edits happen in vim
export EDITOR=nvim

# ISYNTH Environment variables
export ISYNTH_HOME="$HOME/sourcecontrol/isynth"
export ISYNTH_ENVS_HOME="$HOME/sourcecontrol/isynth_envs"

# PYTHONPATH
export PYTHONPATH="$HOME/sourcecontrol/isynth:$HOME/sourcecontrol/isynth_envs/:$PYTHONPATH"

# CDPATH
export CDPATH="$HOME/sourcecontrol/isynth:$HOME/sourcecontrol/isynth_envs/pf_model/"

# Tmux - use a sneaky alias to make the venerable tmux XDG-Compliant:
alias tmux="tmux -f $XDG_CONFIG_HOME/tmux/tmux.conf"


[[ $- == *i* ]] && echo "hello Andrew, .zshrc loaded (Version: 9 Aug 2025). This is XDG compliant"

# ---- macOS-specific bits (guarded) ----
if is_macos; then
  alias python=/opt/homebrew/bin/python3
  export PATH="/opt/homebrew/opt/openjdk/bin:$PATH"
  export LESSOPEN="|/opt/homebrew/bin/lesspipe.sh %s"
  export JAVA_HOME="/opt/homebrew/opt/openjdk/libexec/openjdk.jdk/Contents/Home"
fi
